Execute (create event):
  let game = vimcastle#game#create()
  let game.story = ''
  let game.player = vimcastle#character#create({'short':'', 'long':''}, 1)
  let monsters = vimcastle#repository#create()
  call monsters.add(1, vimcastle#monstergen#create('Imp', 'Imp'))
  let eventgen = vimcastle#eventgen#create('test')
    \.text('There is a %<enemy.name> before you!')
    \.fight('Fight', monsters)

Execute (event executes):
  let event = eventgen.invoke(game)

Then (result):
  AssertEqual [
  \  {'label': 'Fight (level 1)', 'name': 'fight', 'key': 'f'}
  \], event.actions.bindings
  AssertEqual ['There is a <Imp> before you!'], event.log
  AssertEqual 'Imp', game.enemy.name.short

Execute (fight):
  call event.action('fight', game)

Then (change to fight screen):
  AssertEqual 1, game.stats.fights
  AssertEqual 'fight', game.screen
