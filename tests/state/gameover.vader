Before (test vimcastle folder):
  call vimcastle#io#before(expand('~/.vimcastle_tests'))

After (restore vimcastle folder):
  call vimcastle#io#after()

Execute (setup):
  let highscoresfile = vimcastle#io#path('highscores.csv')
  if(filereadable(highscoresfile))
    call delete(highscoresfile)
    call writefile(['1,1,1,1'], highscoresfile)
  endif
  let state = vimcastle#states#create()
  let state.stats = {
    \ 'events': 1,
    \ 'fights': 2,
    \ 'scenes': 3,
    \}
  call state.enter('gameover')

Then (score is calculated and high score is saved):
  AssertEqual 82, state.stats.score
  if(has('patch-7.4.341'))
    AssertEqual ['82,1,2,3', '1,1,1,1'], readfile(highscoresfile)
  endif

Execute (restart):
  call state.actions().invokeDefault(state)

Then (restarts game):
  AssertEqual 'intro', state.screen
  Assert !exists('state.player')
