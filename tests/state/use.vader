Execute (setup):
  let state = vimcastle#state#create()
  call state.enter('use')

Then (has actions):
  AssertEqual [{'label': 'Back', 'key': 'b'}], state.actions().display

Execute (go back):
  let result = state.actions().invokeByKey('b', state)
  Assert result, 'Action was not called'
  AssertEqual 'inventory', state.screen

Execute (setup with items):
  let state.player = vimcastle#character#create({'long': 'Player', 'short': 'You'}, 100)
  let state.player.items = [
  \  {'label': 'Potion of DOOM', 'effect': function('vimcastle#effects#heal'), 'value': 5}, 
  \  {'label': 'Scroll of zoom', 'effect': function('vimcastle#effects#none')}
  \]
  call state.enter('use')

Then (has actions):
  AssertEqual [
  \  {'label': 'Use <Potion of DOOM>', 'key': '1'}, 
  \  {'label': 'Use <Scroll of zoom>', 'key': '2'}, 
  \  {'label': 'Back', 'key': 'b'}
  \], state.actions().display
  AssertEqual [], state.log

Execute (use item keeps if unusable):
  let result = state.actions().invokeByKey('1', state)
  Assert result, 'Action was not called'
  AssertEqual 'use', state.screen
  AssertEqual 2, len(state.player.items)
  AssertEqual ['Use: <Potion of DOOM>', 'Your health is already full!'], state.log

Execute (use item removes if usable):
  let state.player.health = 10
  let result = state.actions().invokeByKey('1', state)
  Assert result, 'Action was not called'
  AssertEqual 'use', state.screen
  AssertEqual 1, len(state.player.items)
  AssertEqual 'Scroll of zoom', state.player.items[0].label
  AssertEqual ['Use: <Potion of DOOM>', 'You gain <5> health'], state.log

Execute (item returns to fight if enemy):
  let state.enemy = vimcastle#monstergen#create('Mon.', 'Monster').invoke()
  let result = state.actions().invokeByKey('1', state)
  AssertEqual 'fight', state.screen

Execute (back returns to fight if enemy):
  call state.enter('use')
  let result = state.actions().invokeByKey('b', state)
  AssertEqual 'fight', state.screen
