Execute (initialize stats):
  let maxturns = 500
  let maxplaythroughs = 50
  let totalturns = 0
  let playthroughsturns = []

Execute (play story):
  let playhtroughs = 0
  while(playhtroughs < maxplaythroughs)
    let state = vimcastle#state#create()
    let state.scene = vimcastle#scene#load('main', 'index')
    call state.enter('explore')
    call state.scene.enter.invoke(state)
    let playhtroughs += 1
    let turns = 0
    while turns < maxturns && state.screen != 'gameover'
      let turns += 1
      if(state.actions.enabled)
        if(vimcastle#utils#rnd(10) < 7)
          call state.actions.items[0].fn(state)
        else
          call vimcastle#utils#oneof(state.actions.items).fn(state)
        endif
      else
        call state.nav.items[0].fn(state)
      endif
    endwhile
    let totalturns += turns
  call add(playthroughsturns, turns)
  endwhile
  let avgturns = totalturns / maxplaythroughs
  Log 'average turns/game: ' . avgturns . ' in ' . maxplaythroughs . ' playthroughs: ' . string(playthroughsturns)

Then (the game completed):
  if(!$CI)
    Assert avgturns > 20 && avgturns < 200, 'Too few/many turns'
  endif
