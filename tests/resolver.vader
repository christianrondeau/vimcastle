Execute (setup):
  let attacker = vimcastle#character#create({ 'short': 'A.', 'long': 'Attacker' }, 100)
  let defender = vimcastle#character#create({ 'short': 'D.', 'long': 'Defender' }, 100)

Execute (simple resolution):
  let dmg = vimcastle#resolver#hit(attacker, defender)

Then:
  AssertEqual 0, dmg

Execute (randomized weapon damage):
  call attacker.equipweapon(vimcastle#equippablegen#weapon('Swd.', 'Sword', 4, 8).invoke())
  call vimcastle#utils#resetrnd()
  call vimcastle#utils#setnextrnd(2) " The damage over the minimum
  call vimcastle#utils#setnextrnd(100) " The dex roll must be <= to dex
  let dmg = vimcastle#resolver#hit(attacker, defender)

Then:
  AssertEqual 6, dmg

Execute (simple weapon damage):
  call attacker.equipweapon(vimcastle#equippablegen#weapon('Swd.', 'Sword', 3, 3).invoke())
  call vimcastle#utils#resetrnd()
  call vimcastle#utils#setnextrnd(0) " The damage over the minimum
  call vimcastle#utils#setnextrnd(100) " The dex roll must be <= to dex
  let dmg = vimcastle#resolver#hit(attacker, defender)

Then:
  AssertEqual 3, dmg

Execute (defense reduces damage):
  call defender.equiparmor(vimcastle#equippablegen#armor('Arm.', 'Armor', 2).invoke())
  call vimcastle#utils#resetrnd()
  call vimcastle#utils#setnextrnd(0) " The damage over the minimum
  call vimcastle#utils#setnextrnd(100) " The dex roll must be <= to dex
  let dmg = vimcastle#resolver#hit(attacker, defender)

Then:
  AssertEqual 1, dmg

Execute (strength increases damage):
  call attacker.setstat('str', 4)
  call vimcastle#utils#resetrnd()
  call vimcastle#utils#setnextrnd(0) " The damage over the minimum
  call vimcastle#utils#setnextrnd(100) " The dex roll must be <= to dex
  let dmg = vimcastle#resolver#hit(attacker, defender)

Then:
  AssertEqual 5, dmg

Execute (dex increases crit chances):
  call attacker.setstat('dex', 4)
  call vimcastle#utils#resetrnd()
  call vimcastle#utils#setnextrnd(0) " The damage over the minimum
  call vimcastle#utils#setnextrnd(4) " The dex roll must be <= to dex
  let dmg = vimcastle#resolver#hit(attacker, defender)

Then:
  AssertEqual 10, dmg

